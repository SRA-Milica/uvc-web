import{d as R,c as w,a3 as j,a as s,b as t,F as v,r as x,a7 as D,a0 as $,o as l,n as T,l as V,p as C,t as r,u as m,a2 as S,a1 as u,s as y}from"./index-75810c09.js";const B=t("div",{class:"flex justify-between items-center mb-10"},[t("div",{class:"section-title"},[t("h2",{class:"text-2xl"},[t("span",null,"確認済みメッセージ")])])],-1),M={key:0,class:"text-center text-lg text-gray-500"},U={key:1},L={class:"table"},z=t("thead",null,[t("tr",{class:"text-xl text-center"},[t("th",null,"Title"),t("th",null,"Contents"),t("th",null,"Sender"),t("th",null,"Recipients Total"),t("th",null,"Confirmed"),t("th",null,"Recipients Details"),t("th",null,"Actions")])],-1),E={key:0},F={key:1},I=["onClick"],G=R({__name:"ConfirmedMessages",setup(O){const k=D(),h=e=>e.confirmed_receivers?e.confirmed_receivers.split(",").length:0,d=e=>e.recipient_ids.length,f=w(()=>k.filter(e=>e.category===j)),g=e=>{const _=`Title	${e.title}`,i=`Contents	${e.context}`,n=[`Number of target recipients	${d(e)}`,`Number of read	${h(e)}`,`Number of unread	${d(e)-h(e)}`].join("	"),o=["Student ID","Name","Organization","Grade","Read/Unread"].join("	"),c=e.recipient_ids.sort((a,p)=>(a||"").localeCompare(p||"")).map(a=>{var b;const p=(b=e.confirmed_receivers)!=null&&b.split(",").includes(a)?"Read":"Unread";return[a||"",u(a).name||"",u(a).organization||"",u(a).grade||"",p].join("	")}).join(`
`);return[_,i,"",n,o,c].join(`
`)},N=e=>{const _=g(e),i=new Blob([_],{type:"text/tab-separated-values;charset=utf-8;"}),n=URL.createObjectURL(i),o=document.createElement("a");o.href=n;const c=`${e.title.replace(/[\/\\?%*:|"<>]/g,"-")}.csv`;o.download=c,document.body.appendChild(o),o.click(),document.body.removeChild(o)};return(e,_)=>{const i=$("router-link");return l(),s("div",null,[B,t("div",null,[f.value.length===0?(l(),s("div",M," No new results to show. ")):(l(),s("div",U,[t("table",L,[z,t("tbody",null,[(l(!0),s(v,null,x(f.value,n=>(l(),s("tr",{key:n.id,class:"text-base text-center"},[t("td",null,[T(i,{to:{name:"MessageDetail",params:{id:n.id}}},{default:V(()=>[C(r(n.title),1)]),_:2},1032,["to"])]),t("td",null,r(n.context),1),t("td",null,"("+r(m(S)(n.schedule_date_from))+") "+r(m(u)(n.sender_id).name),1),t("td",null,r(d(n)),1),t("td",null,r(h(n))+" / "+r(d(n)),1),t("td",null,[(l(!0),s(v,null,x(n.recipient_ids,(o,c)=>(l(),s("span",{key:c},[C(r(m(u)(o).name)+" ",1),c<n.recipient_ids.length-1?(l(),s("span",E,", ")):y("",!0),c<n.recipient_ids.length-1?(l(),s("br",F)):y("",!0)]))),128))]),t("td",null,[t("button",{onClick:o=>N(n),class:"button secondary-button text-base"}," Download ",8,I)])]))),128))])])]))])])}}});export{G as default};
